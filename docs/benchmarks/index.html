<!doctype html><html lang=zh-CN><meta charset=utf-8><title>Running benchmarks locally · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="This document explains how to run classic benchmark suites in d8." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li><a href=/blog/ >博客</a><li class=active><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><h1>Running benchmarks locally</h1><p>We have a simple workflow for running the “classic” benchmarks of SunSpider, Kraken and Octane. You can run with different binaries and flag combinations, and results are averaged over multiple runs.<h2 id=cpu>CPU <a href=#cpu class=bookmark>#</a></h2><p>Build the <code>d8</code> shell following the instructions at <a href=/docs/build-gn>Building with GN</a>.<p>Before you run benchmarks, make sure you set your CPU frequency scaling governor to performance.<pre class=language-bash><code class=language-bash><span class="token function">sudo</span> tools/cpu.sh fast</code></pre><p>The commands <code>cpu.sh</code> understands are<ul><li><code>fast</code>, performance (alias for <code>fast</code>)<li><code>slow</code>, powersave (alias for <code>slow</code>)<li><code>default</code>, ondemand (alias for <code>default</code>)<li><code>dualcore</code> (disables all but two cores), dual (alias for <code>dualcore</code>)<li><code>allcores</code> (re-enables all available cores), all (alias for <code>allcores</code>).</ul><h2 id=csuite>CSuite <a href=#csuite class=bookmark>#</a></h2><p><code>CSuite</code> is our simple benchmark runner:<pre class=language-bash><code class=language-bash>test/benchmarks/csuite/csuite.py<br>    <span class="token punctuation">(</span>sunspider <span class="token operator">|</span> kraken <span class="token operator">|</span> octane<span class="token punctuation">)</span><br>    <span class="token punctuation">(</span>baseline <span class="token operator">|</span> compare<span class="token punctuation">)</span><br>    <span class="token operator">&lt;</span>path to d8 binary<span class="token operator">></span><br>    <span class="token punctuation">[</span>-x <span class="token string">"&lt;optional extra d8 command-line flags>"</span><span class="token punctuation">]</span></code></pre><p>First run in <code>baseline</code> mode to create the baselines, then in <code>compare</code> mode to get results. <code>CSuite</code> defaults to doing 10 runs for Octane, 100 for SunSpider, and 80 for Kraken, but you can override these for quicker results with the <code>-r</code> option.<p><code>CSuite</code> creates two subdirectories in the directory where you run from:<ol><li><code>./_benchmark_runner_data</code> — this is cached output from the N runs.<li><code>./_results</code> — it writes the results into file master here. You could save these<br>files with different names, and they’ll show up in compare mode.</ol><p>In compare mode, you’ll naturally use a different binary or at least different flags.<h2 id=example-usage>Example usage <a href=#example-usage class=bookmark>#</a></h2><p>Say you’ve built two versions of <code>d8</code>, and want to see what happens to SunSpider. First, create baselines:<pre class=language-bash><code class=language-bash>$ test/benchmarks/csuite/csuite.py sunspider baseline out.gn/master/d8<br>Wrote ./_results/master.<br>Run sunspider again with compare mode to see results.</code></pre><p>As suggested, run again but this time in <code>compare</code> mode with a different binary:<pre><code>$ test/benchmarks/csuite/csuite.py sunspider compare out.gn/x64.release/d8

                               benchmark:    score |   master |      % |
===================================================+==========+========+
                       3d-cube-sunspider:     13.9 S     13.4 S   -3.6 |
                      3d-morph-sunspider:      8.6 S      8.4 S   -2.3 |
                   3d-raytrace-sunspider:     15.1 S     14.9 S   -1.3 |
           access-binary-trees-sunspider:      3.7 S      3.9 S    5.4 |
               access-fannkuch-sunspider:     11.9 S     11.8 S   -0.8 |
                  access-nbody-sunspider:      4.6 S      4.8 S    4.3 |
                 access-nsieve-sunspider:      8.4 S      8.1 S   -3.6 |
      bitops-3bit-bits-in-byte-sunspider:      2.0 |      2.0 |        |
           bitops-bits-in-byte-sunspider:      3.7 S      3.9 S    5.4 |
            bitops-bitwise-and-sunspider:      2.7 S      2.9 S    7.4 |
            bitops-nsieve-bits-sunspider:      5.3 S      5.6 S    5.7 |
         controlflow-recursive-sunspider:      3.8 S      3.6 S   -5.3 |
                    crypto-aes-sunspider:     10.9 S      9.8 S  -10.1 |
                    crypto-md5-sunspider:      7.0 |      7.4 S    5.7 |
                   crypto-sha1-sunspider:      9.2 S      9.0 S   -2.2 |
             date-format-tofte-sunspider:      9.8 S      9.9 S    1.0 |
             date-format-xparb-sunspider:     10.3 S     10.3 S        |
                   math-cordic-sunspider:      6.1 S      6.2 S    1.6 |
             math-partial-sums-sunspider:     20.2 S     20.1 S   -0.5 |
            math-spectral-norm-sunspider:      3.2 S      3.0 S   -6.2 |
                    regexp-dna-sunspider:      7.6 S      7.8 S    2.6 |
                 string-base64-sunspider:     14.2 S     14.0 |   -1.4 |
                  string-fasta-sunspider:     12.8 S     12.6 S   -1.6 |
               string-tagcloud-sunspider:     18.2 S     18.2 S        |
            string-unpack-code-sunspider:     20.0 |     20.1 S    0.5 |
         string-validate-input-sunspider:      9.4 S      9.4 S        |
                               SunSpider:    242.6 S    241.1 S   -0.6 |
---------------------------------------------------+----------+--------+
</code></pre><p>The output of the previous run is cached in a subdirectory created in the current directory (<code>_benchmark_runner_data</code>). The aggregate results are also cached, in directory <code>_results</code>. These directories can be deleted after you’ve run the compare step.<p>Another situation is when you have the same binary, but want to see the results of different flags. Feeling rather droll, you’d like to see how Octane performs without an optimizing compiler. First the baseline:<pre class=language-bash><code class=language-bash>$ test/benchmarks/csuite/csuite.py -r <span class="token number">1</span> octane baseline out.gn/x64.release/d8<br><br>Normally, octane requires <span class="token number">10</span> runs to get stable results.<br>Wrote /usr/local/google/home/mvstanton/src/v8/_results/master.<br>Run octane again with compare mode to see results.</code></pre><p>Note the warning that one run usually isn’t enough to be sure of many performance optimizations, however, our “change” should have a reproducible effect with only one run! Now let’s compare, passing the <code>--noopt</code> flag to turn off <a href=/docs/turbofan>TurboFan</a>:<pre class=language-bash><code class=language-bash>$ test/benchmarks/csuite/csuite.py -r <span class="token number">1</span> octane compare out.gn/x64.release/d8 <span class="token punctuation">\</span><br>  -x <span class="token string">"--noopt"</span><br><br>Normally, octane requires <span class="token number">10</span> runs to get stable results.<br>                               benchmark:    score <span class="token operator">|</span>   master <span class="token operator">|</span>      % <span class="token operator">|</span><br><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">+=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span><span class="token operator">+=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>+<br>                                Richards:    <span class="token number">973.0</span> <span class="token operator">|</span>  <span class="token number">26770.0</span> <span class="token operator">|</span>  -96.4 <span class="token operator">|</span><br>                               DeltaBlue:   <span class="token number">1070.0</span> <span class="token operator">|</span>  <span class="token number">57245.0</span> <span class="token operator">|</span>  -98.1 <span class="token operator">|</span><br>                                  Crypto:    <span class="token number">923.0</span> <span class="token operator">|</span>  <span class="token number">32550.0</span> <span class="token operator">|</span>  -97.2 <span class="token operator">|</span><br>                                RayTrace:   <span class="token number">2896.0</span> <span class="token operator">|</span>  <span class="token number">75035.0</span> <span class="token operator">|</span>  -96.1 <span class="token operator">|</span><br>                             EarleyBoyer:   <span class="token number">4363.0</span> <span class="token operator">|</span>  <span class="token number">42779.0</span> <span class="token operator">|</span>  -89.8 <span class="token operator">|</span><br>                                  RegExp:   <span class="token number">2881.0</span> <span class="token operator">|</span>   <span class="token number">6611.0</span> <span class="token operator">|</span>  -56.4 <span class="token operator">|</span><br>                                   Splay:   <span class="token number">4241.0</span> <span class="token operator">|</span>  <span class="token number">19489.0</span> <span class="token operator">|</span>  -78.2 <span class="token operator">|</span><br>                            SplayLatency:  <span class="token number">14094.0</span> <span class="token operator">|</span>  <span class="token number">57192.0</span> <span class="token operator">|</span>  -75.4 <span class="token operator">|</span><br>                            NavierStokes:   <span class="token number">1308.0</span> <span class="token operator">|</span>  <span class="token number">39208.0</span> <span class="token operator">|</span>  -96.7 <span class="token operator">|</span><br>                                   PdfJS:   <span class="token number">6385.0</span> <span class="token operator">|</span>  <span class="token number">26645.0</span> <span class="token operator">|</span>  -76.0 <span class="token operator">|</span><br>                                Mandreel:    <span class="token number">709.0</span> <span class="token operator">|</span>  <span class="token number">33166.0</span> <span class="token operator">|</span>  -97.9 <span class="token operator">|</span><br>                         MandreelLatency:   <span class="token number">5407.0</span> <span class="token operator">|</span>  <span class="token number">97749.0</span> <span class="token operator">|</span>  -94.5 <span class="token operator">|</span><br>                                 Gameboy:   <span class="token number">5440.0</span> <span class="token operator">|</span>  <span class="token number">54336.0</span> <span class="token operator">|</span>  -90.0 <span class="token operator">|</span><br>                                CodeLoad:  <span class="token number">25631.0</span> <span class="token operator">|</span>  <span class="token number">25282.0</span> <span class="token operator">|</span>    <span class="token number">1.4</span> <span class="token operator">|</span><br>                                   Box2D:   <span class="token number">3288.0</span> <span class="token operator">|</span>  <span class="token number">67572.0</span> <span class="token operator">|</span>  -95.1 <span class="token operator">|</span><br>                                    zlib:  <span class="token number">59154.0</span> <span class="token operator">|</span>  <span class="token number">58775.0</span> <span class="token operator">|</span>    <span class="token number">0.6</span> <span class="token operator">|</span><br>                              Typescript:  <span class="token number">12700.0</span> <span class="token operator">|</span>  <span class="token number">23310.0</span> <span class="token operator">|</span>  -45.5 <span class="token operator">|</span><br>                                  Octane:   <span class="token number">4070.0</span> <span class="token operator">|</span>  <span class="token number">37234.0</span> <span class="token operator">|</span>  -89.1 <span class="token operator">|</span><br>---------------------------------------------------+----------+--------+</code></pre><p>Neat to see that <code>CodeLoad</code> and <code>zlib</code> were relatively unharmed.<h2 id=under-the-hood>Under the hood <a href=#under-the-hood class=bookmark>#</a></h2><p><code>CSuite</code> is based on two scripts in the same directory, <code>benchmark.py</code> and <code>compare-baseline.py</code>. There are more options in those scripts. For example, you can record multiple baselines and do 3-, 4-, or 5-way comparisons. <code>CSuite</code> is optimized for quick use, and sacrifices some flexibility.</main><footer id=footer><div><nav><a href=https://v8.dev/docs/benchmarks>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/docs/benchmarks.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>