<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 release v7.7 · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="V8 v7.7 features lazy feedback allocation, faster WebAssembly background compilation, stack trace improvements, and new Intl.NumberFormat functionality." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 release v7.7</h1><p class=meta>发布时间 <time datetime="2019-08-13 16:45:00" itemprop=datePublished title="2019-08-13 16:45:00">2019-08-13</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>Every six weeks, we create a new branch of V8 as part of our <a href=/docs/release-process>release process</a>. Each version is branched from V8’s Git master immediately before a Chrome Beta milestone. Today we’re pleased to announce our newest branch, <a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/7.7>V8 version 7.7</a>, which is in beta until its release in coordination with Chrome 77 Stable in several weeks. V8 v7.7 is filled with all sorts of developer-facing goodies. This post provides a preview of some of the highlights in anticipation of the release.<h2 id=performance>Performance (size & speed) <a href=#performance class=bookmark>#</a></h2><h3 id=lazy-feedback-allocation>Lazy feedback allocation <a href=#lazy-feedback-allocation class=bookmark>#</a></h3><p>In order to optimize JavaScript, V8 collects feedback about the types of operands which are passed to various operations (e.g. <code>+</code> or <code>o.foo</code>). This feedback is used to optimize these operations by tailoring them to those specific types. This information is stored in “feedback vectors”, and while this information is very important to achieve faster execution times, we also pay a cost for the memory usage required to allocate these feedback vectors.<p>To reduce V8’s memory usage, we now allocate the feedback vectors lazily only after the function has executed a certain amount of bytecode. This avoids allocating feedback vectors for short-lived functions that don’t benefit from the feedback collected. Our lab experiments show that lazily allocating feedback vectors saves about 2–8% of V8 heap size.<figure><img alt="" height=365 loading=lazy src=/_img/v8-release-77/lazy-feedback-allocation.svg width=904></figure><p>Our experiments from the wild show that this reduces V8’s heap size by 1–2% on desktop and 5–6% on mobile platforms for the users of Chrome. There are no performance regressions on desktop, and on mobile platforms we actually saw a performance improvement on low-end phones with limited memory. Please look out for a more detailed blog post on our recent work to save memory.<h3 id=wasm-compilation>Scalable WebAssembly background compilation <a href=#wasm-compilation class=bookmark>#</a></h3><p>Over the last milestones, we worked on scalability of background compilation of WebAssembly. The more cores your computer has, the more you benefit from this effort. The graphs below have been created on a 24-core Xeon machine, compiling <a href=https://s3.amazonaws.com/mozilla-games/ZenGarden/EpicZenGarden.html>the Epic ZenGarden demo</a>. Depending on the number of threads used, compilation takes less than half of the time compared to V8 v7.4.<figure><img alt="" height=203 loading=lazy src=/_img/v8-release-77/liftoff-compilation-speedup.svg width=514></figure><figure><img alt="" height=203 loading=lazy src=/_img/v8-release-77/turbofan-compilation-speedup.svg width=514></figure><h3 id=stack-trace-improvements>Stack trace improvements <a href=#stack-trace-improvements class=bookmark>#</a></h3><p>Almost all errors thrown by V8 capture a stack trace when they are created. This stack trace can be accessed from JavaScript through the non-standard <code>error.stack</code> property. The first time a stack trace is retrieved via <code>error.stack</code>, V8 serializes the underlying structured stack trace into a string. This serialized stack trace is kept around to speed up future <code>error.stack</code> accesses.<p>Over the last few versions we worked on some <a href=https://docs.google.com/document/d/1WIpwLgkIyeHqZBc9D3zDtWr7PL-m_cH6mfjvmoC6kSs/edit>internal refactorings to the stack trace logic</a> (<a href="https://bugs.chromium.org/p/v8/issues/detail?id=8742">tracking bug</a>), simplifying the code and improving stack trace serialization performance by up to 30%.<h2 id=javascript-language-features>JavaScript language features <a href=#javascript-language-features class=bookmark>#</a></h2><p><a href=/features/intl-numberformat>The <code>Intl.NumberFormat</code> API</a> for locale-aware number formatting gains new functionality in this release! It now supports compact notation, scientific notation, engineering notation, sign display, and units of measurement.<pre class=language-js><code class=language-js><span class="token keyword">const</span> formatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intl<span class="token punctuation">.</span>NumberFormat</span><span class="token punctuation">(</span><span class="token string">'en'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">'unit'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">unit</span><span class="token operator">:</span> <span class="token string">'meter-per-second'</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>formatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token number">299792458</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → '299,792,458 m/s'</span></code></pre><p>Refer to <a href=/features/intl-numberformat>our feature explainer</a> for more details.<h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><p>Please use <code>git log branch-heads/7.6..branch-heads/7.7 include/v8.h</code> to get a list of the API changes.<p>Developers with an <a href=/docs/source-code#using-git>active V8 checkout</a> can use <code>git checkout -b 7.7 -t branch-heads/7.7</code> to experiment with the new features in V8 v7.7. Alternatively you can <a href=https://www.google.com/chrome/browser/beta.html>subscribe to Chrome’s Beta channel</a> and try the new features out yourself soon.</div><footer><div><picture><source srcset="/_img/avatars/mathias-bynens.avif, /_img/avatars/mathias-bynens@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/mathias-bynens.jpg width=96 srcset="/_img/avatars/mathias-bynens@2x.jpg 2x"></picture><p>作者：Mathias Bynens (<a href=https://twitter.com/mathias>@mathias</a>), lazy allocator of release notes.</div><a href=https://twitter.com/v8js/status/1161287541611323397 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-77>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-77.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>