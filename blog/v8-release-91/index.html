<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 release v9.1 · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="V8 release v9.1 brings support for private brand checks, top-level await enabled by default and performance improvements." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 release v9.1</h1><p class=meta>发布时间 <time datetime="2021-05-04 00:00:00" itemprop=datePublished title="2021-05-04 00:00:00">2021-05-04</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>Every six weeks, we create a new branch of V8 as part of our <a href=https://v8.dev/docs/release-process>release process</a>. Each version is branched from V8’s Git master immediately before a Chrome Beta milestone. Today we’re pleased to announce our newest branch, <a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/9.1>V8 version 9.1</a>, which is in beta until its release in coordination with Chrome 91 Stable in several weeks. V8 v9.1 is filled with all sorts of developer-facing goodies. This post provides a preview of some of the highlights in anticipation of the release.<h2 id=javascript>JavaScript <a href=#javascript class=bookmark>#</a></h2><h3 id=fasttemplatecache-improvements><code>FastTemplateCache</code> improvements <a href=#fasttemplatecache-improvements class=bookmark>#</a></h3><p>The v8 API exposes a <code>Template</code> interface to the embedders from which new instances can be created.<p>Creating and configuring new object instances requires several steps which is why it’s often faster to clone existing objects instead. V8 uses a two level cache strategy (small fast array cache and a large slow dictionary cache) to lookup recently created objects based on the templates and clone them directly.<p>Previously, the cache index for templates was assigned when the templates were created, rather than when they were inserted into the cache. This resulted in the fast array cache being reserved for the templates that were often never instantiated at all. Fixing this resulted in a 4.5% improvement in the Speedometer2-FlightJS benchmark.<h3 id=top-level-await>Top-level <code>await</code> <a href=#top-level-await class=bookmark>#</a></h3><p><a href=https://v8.dev/features/top-level-await>Top-level <code>await</code></a> is enabled by default in V8 starting with v9.1 and is available without <code>--harmony-top-level-await</code>.<p>Please note that for the <a href=https://www.chromium.org/blink>Blink rendering engine</a>, top-level <code>await</code> was already <a href=https://v8.dev/blog/v8-release-89#top-level-await>enabled by default</a> in version 89.<p>Embedders should note that with this enablement, <code>v8::Module::Evaluate</code> always returns a <code>v8::Promise</code> object instead of the completion value. The <code>Promise</code> is resolved with the completion value if module evaluation succeeds and rejected with the error if evaluation fails. If the evaluated module is not asynchronous (i.e. does not contain top-level <code>await</code>) and does not have any asynchronous dependencies, the returned <code>Promise</code> will either be fulfilled or rejected. Otherwise the returned <code>Promise</code> will be pending.<p>Please see <a href=https://v8.dev/features/top-level-await>our explainer</a> for more details.<h3 id=private-brand-checks-a.k.a.-%23foo-in-obj>Private brand checks a.k.a. <code>#foo in obj</code> <a href=#private-brand-checks-a.k.a.-%23foo-in-obj class=bookmark>#</a></h3><p>The private brands check syntax is enabled by default in v9.1 without requiring <code>--harmony-private-brand-checks</code>. This feature extends the <a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/in><code>in</code> operator</a> to also work with private fields' <code>#</code>-names, such as in the following example.<pre class=language-javascript><code class=language-javascript><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><br>  <span class="token keyword">static</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>#foo <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  #foo <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><br><span class="token constant">A</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span></code></pre><p>For a deeper dive, be sure to check out <a href=https://v8.dev/features/private-brand-checks>our explainer</a>.<h3 id=short-builtin-calls>Short builtin calls <a href=#short-builtin-calls class=bookmark>#</a></h3><p>In this release we have temporarily turned unembed builtins (undoing <a href=https://v8.dev/blog/embedded-builtins>embedded builtins</a>) on 64-bit desktop machines. The performance benefit of unembedding builtins on those machines outweighs the memory costs. This is due to architectural as well as micro-achitectural details.<p>We'll publish a separate blog post with more details soon.<h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><p>Please use <code>git log branch-heads/9.0..branch-heads/9.1 include/v8.h</code> to get a list of the API changes.<p>Developers with an active V8 checkout can use <code>git checkout -b 9.1 -t branch-heads/9.1</code> to experiment with the new features in V8 v9.1. Alternatively you can <a href=https://www.google.com/chrome/browser/beta.html>subscribe to Chrome’s Beta channel</a> and try the new features out yourself soon.</div><footer><div><picture><source srcset="/_img/avatars/ingvar-stepanyan.avif, /_img/avatars/ingvar-stepanyan@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/ingvar-stepanyan.jpg srcset="/_img/avatars/ingvar-stepanyan@2x.jpg 2x" width=96></picture><p>作者：Ingvar Stepanyan (<a href=https://twitter.com/RReverser>@RReverser</a>), testing my private brand.</div><a href=https://twitter.com/v8js/status/1389613320953532417 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-91>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-91.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>