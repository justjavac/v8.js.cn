<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 release v8.3 · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="V8 v8.3 features faster ArrayBuffers, bigger Wasm memories and deprecated APIs." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 release v8.3</h1><p class=meta>发布时间 <time datetime="2020-05-04 00:00:00" itemprop=datePublished title="2020-05-04 00:00:00">2020-05-04</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>Every six weeks, we create a new branch of V8 as part of our <a href=https://v8.dev/docs/release-process>release process</a>. Each version is branched from V8’s Git master immediately before a Chrome Beta milestone. Today we’re pleased to announce our newest branch, <a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/8.3>V8 version 8.3</a>, which is in beta until its release in coordination with Chrome 83 Stable in several weeks. V8 v8.3 is filled with all sorts of developer-facing goodies. This post provides a preview of some of the highlights in anticipation of the release.<h2 id=performance>Performance <a href=#performance class=bookmark>#</a></h2><h3 id=faster-arraybuffer-tracking-in-the-garbage-collector>Faster <code>ArrayBuffer</code> tracking in the garbage collector <a href=#faster-arraybuffer-tracking-in-the-garbage-collector class=bookmark>#</a></h3><p>Backing stores of <code>ArrayBuffer</code>s are allocated outside V8’s heap using <code>ArrayBuffer::Allocator</code> provided by the embedder. These backing stores need to be released when their <code>ArrayBuffer</code> object is reclaimed by the garbage collector. V8 v8.3 has a new mechanism for tracking <code>ArrayBuffer</code>s and their backing stores that allows the garbage collector to iterate and free the backing store concurrently to the application. More details are available in <a href="https://docs.google.com/document/d/1-ZrLdlFX1nXT3z-FAgLbKal1gI8Auiaya_My-a0UJ28/edit#heading=h.gfz6mi5p212e">this design document</a>. This reduced total GC pause time in <code>ArrayBuffer</code> heavy workloads by 50%.<h3 id=bigger-wasm-memories>Bigger Wasm memories <a href=#bigger-wasm-memories class=bookmark>#</a></h3><p>In accordance with an update to the <a href=https://webassembly.github.io/spec/js-api/index.html#limits>WebAssembly specification</a>, V8 v8.3 now allows modules to request memories up to 4GB in size, allowing more memory-heavy use cases to be brought to platforms powered by V8. Please keep in mind that this much memory might not always be available on a user’s system; we recommend creating memories at smaller sizes, growing them as needed, and gracefully handling failures to grow.<h2 id=fixes>Fixes <a href=#fixes class=bookmark>#</a></h2><h3 id=stores-to-objects-with-typed-arrays-on-the-prototype-chain>Stores to objects with typed arrays on the prototype chain <a href=#stores-to-objects-with-typed-arrays-on-the-prototype-chain class=bookmark>#</a></h3><p>According to the JavaScript specification, when storing a value to the specified key we need to lookup the prototype chain to see if the key already exists on the prototype. More often than not these keys don’t exist on the prototype chain, and so V8 installs fast lookup handlers to avoid these prototype chain walks when it is safe to do so.<p>However, we recently identified a particular scenario where V8 incorrectly installed this fast lookup handler, leading to incorrect behaviour. When <code>TypedArray</code>s are on the prototype chain, all stores to keys which are OOB of the <code>TypedArray</code> should be ignored. For example, in the case below <code>v[2]</code> shouldn’t add a property to <code>v</code> and the subsequent reads should return undefined.<pre class=language-js><code class=language-js>v <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>v<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int32Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span><br><span class="token keyword">return</span> v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Should return undefined</span></code></pre><p>V8’s fast lookup handlers don’t handle this case, and we would instead return <code>123</code> in the above example. V8 v8.3 fixes this issue by not using fast lookup handlers when <code>TypedArray</code>s are on the prototype chain. Given that this isn’t a common case, we haven’t seen any performance regression on our benchmarks.<h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><h3 id=experimental-weakrefs-and-finalizationregistry-apis-deprecated>Experimental WeakRefs and FinalizationRegistry APIs deprecated <a href=#experimental-weakrefs-and-finalizationregistry-apis-deprecated class=bookmark>#</a></h3><p>The following experimental WeakRefs-related APIs are deprecated:<ul><li><code>v8::FinalizationGroup</code><li><code>v8::Isolate::SetHostCleanupFinalizationGroupCallback</code></ul><p><code>FinalizationRegistry</code> (renamed from <code>FinalizationGroup</code>) is part of the <a href=https://v8.dev/features/weak-references>JavaScript weak references proposal</a> and provides a way for JavaScript programmers to register finalizers. These APIs are for the embedder to schedule and run <code>FinalizationRegistry</code> cleanup tasks where the registered finalizers are invoked; they are deprecated because they are no longer needed. <code>FinalizationRegistry</code> cleanup tasks are now scheduled automatically by V8 using the foreground task runner provided by the embedder’s <code>v8::Platform</code> and do not require any additional embedder code.<h3 id=other-api-changes>Other API changes <a href=#other-api-changes class=bookmark>#</a></h3><p>Please use <code>git log branch-heads/8.1..branch-heads/8.3 include/v8.h</code> to get a list of the API changes.<p>Developers with an active V8 checkout can use <code>git checkout -b 8.3 -t branch-heads/8.3</code> to experiment with the new features in V8 v8.3. Alternatively you can <a href=https://www.google.com/chrome/browser/beta.html>subscribe to Chrome’s Beta channel</a> and try the new features out yourself soon.</div><footer><div><picture><source srcset="/_img/avatars/victor-gomes.avif, /_img/avatars/victor-gomes@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/victor-gomes.jpg srcset="/_img/avatars/victor-gomes@2x.jpg 2x" width=96></picture><p>作者：<a href=https://twitter.com/VictorBFG>Victor Gomes</a>, safely working from home.</div><a href=https://twitter.com/v8js/status/1257333120115847171 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-83>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-83.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>