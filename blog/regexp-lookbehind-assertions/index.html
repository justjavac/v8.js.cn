<!doctype html><html lang=zh-CN><meta charset=utf-8><title>RegExp lookbehind assertions · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="JavaScript regular expressions are getting some new functionality: lookbehind assertions." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>RegExp lookbehind assertions</h1><p class=meta>发布时间 <time datetime="2016-02-26 13:33:37" itemprop=datePublished title="2016-02-26 13:33:37">2016-02-26</time> · 标签： <a href=/blog/tags/ecmascript/ class=tag>ECMAScript</a> <a href=/blog/tags/regexp/ class=tag>RegExp</a></header><div itemprop=articleBody><p>Introduced with the third edition of the ECMA-262 specification, regular expressions have been part of Javascript since 1999. In functionality and expressiveness, JavaScript’s implementation of regular expressions roughly mirrors that of other programming languages.<p>One feature in JavaScript’s RegExp that is often overlooked, but can be quite useful at times, is lookahead assertions. For example, to match a sequence of digits that is followed by a percent sign, we can use <code>/\d+(?=%)/</code>. The percent sign itself is not part of the match result. The negation thereof, <code>/\d+(?!%)/</code>, would match a sequence of digits not followed by a percent sign:<pre class=language-js><code class=language-js><span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">\d+(?=%)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'100% of US presidents have been male'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['100']</span><br><span class="token operator">/</span>\d<span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">!</span><span class="token operator">%</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'that’s all 44 of them'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// ['44']</span></code></pre><p>The opposite of lookahead, lookbehind assertions, have been missing in JavaScript, but are available in other regular expression implementations, such as that of the .NET framework. Instead of reading ahead, the regular expression engine reads backwards for the match inside the assertion. A sequence of digits following a dollar sign can be matched by <code>/(?&lt;=\$)\d+/</code>, where the dollar sign would not be part of the match result. The negation thereof, <code>/(?&lt;!\$)\d+/</code>, matches a sequence of digits following anything but a dollar sign.<pre class=language-js><code class=language-js><span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">(?&lt;=\$)\d+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'Benjamin Franklin is on the $100 bill'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['100']</span><br><span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">&lt;</span><span class="token operator">!</span>\$<span class="token punctuation">)</span>\d<span class="token operator">+</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'it’s worth about €90'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// ['90']</span></code></pre><p>Generally, there are two ways to implement lookbehind assertions. Perl, for example, requires lookbehind patterns to have a fixed length. That means that quantifiers such as <code>*</code> or <code>+</code> are not allowed. This way, the regular expression engine can step back by that fixed length, and match the lookbehind the exact same way as it would match a lookahead, from the stepped back position.<p>The regular expression engine in the .NET framework takes a different approach. Instead of needing to know how many characters the lookbehind pattern will match, it simply matches the lookbehind pattern backwards, while reading characters against the normal read direction. This means that the lookbehind pattern can take advantage of the full regular expression syntax and match patterns of arbitrary length.<p>Clearly, the second option is more powerful than the first. That is why the V8 team, and the TC39 champions for this feature, have agreed that JavaScript should adopt the more expressive version, even though its implementation is slightly more complex.<p>Because lookbehind assertions match backwards, there are some subtle behaviors that would otherwise be considered surprising. For example, a capturing group with a quantifier captures the last match. Usually, that is the right-most match. But inside a lookbehind assertion, we match from right to left, therefore the left-most match is captured:<pre class=language-js><code class=language-js><span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">h(?=(\w)+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'hodor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ['h', 'r']</span><br><span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">&lt;=</span><span class="token punctuation">(</span>\w<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">)</span>r<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'hodor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['r', 'h']</span></code></pre><p>A capturing group can be referenced via back reference after it has been captured. Usually, the back reference has to be to the right of the capture group. Otherwise, it would match the empty string, as nothing has been captured yet. However, inside a lookbehind assertion, the match direction is reversed:<pre class=language-js><code class=language-js><span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">(?&lt;=(o)d\1)r</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'hodor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// null</span><br><span class="token operator">/</span><span class="token punctuation">(</span><span class="token operator">?</span><span class="token operator">&lt;=</span>\<span class="token number">1</span><span class="token function">d</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span>r<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'hodor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['r', 'o']</span></code></pre><p>Lookbehind assertions are currently in a very <a href=https://github.com/tc39/proposal-regexp-lookbehind>early stage</a> in the TC39 specification process. However, because they are such an obvious extension to the RegExp syntax, we decided to prioritize their implementation. You can already experiment with lookbehind assertions by running V8 version 4.9 or later with <code>--harmony</code>, or by enabling experimental JavaScript features (use <code>about:flags</code>) in Chrome from version 49 onwards.</div><footer><div><picture><source srcset="/_img/avatars/yang-guo.avif, /_img/avatars/yang-guo@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/yang-guo.jpg srcset="/_img/avatars/yang-guo@2x.jpg 2x" width=96></picture><p>作者：Yang Guo, Regular Expression Engineer.</div></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/regexp-lookbehind-assertions>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/regexp-lookbehind-assertions.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>