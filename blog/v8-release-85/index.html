<!doctype html><html lang=zh-CN><meta charset=utf-8><title>V8 release v8.5 · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="V8 release v8.5 features Promise.any, String#replaceAll, logical assignment operators, WebAssembly multi-value and BigInt support, and performance improvements." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>V8 release v8.5</h1><p class=meta>发布时间 <time datetime="2020-07-21 00:00:00" itemprop=datePublished title="2020-07-21 00:00:00">2020-07-21</time> · 标签： <a href=/blog/tags/release/ class=tag>release</a></header><div itemprop=articleBody><p>Every six weeks, we create a new branch of V8 as part of our <a href=https://v8.dev/docs/release-process>release process</a>. Each version is branched from V8’s Git master immediately before a Chrome Beta milestone. Today we’re pleased to announce our newest branch, <a href=https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/8.5>V8 version 8.5</a>, which is in beta until its release in coordination with Chrome 85 Stable in several weeks. V8 v8.5 is filled with all sorts of developer-facing goodies. This post provides a preview of some of the highlights in anticipation of the release.<h2 id=javascript>JavaScript <a href=#javascript class=bookmark>#</a></h2><h3 id=promise.any-and-aggregateerror><code>Promise.any</code> and <code>AggregateError</code> <a href=#promise.any-and-aggregateerror class=bookmark>#</a></h3><p><code>Promise.any</code> is a promise combinator that resolves the resulting promise as soon as one of the input promises is fulfilled.<pre class=language-js><code class=language-js><span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><br>  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/endpoint-a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/endpoint-b'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/endpoint-c'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">]</span><span class="token punctuation">;</span><br><span class="token keyword">try</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> first <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// Any of the promises was fulfilled.</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// → e.g. 'b'</span><br><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// All of the promises were rejected.</span><br>  console<span class="token punctuation">.</span><span class="token function">assert</span><span class="token punctuation">(</span>error <span class="token keyword">instanceof</span> <span class="token class-name">AggregateError</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// Log the rejection values:</span><br>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>If all input promises are rejected, the resulting promise is rejected with an <code>AggregateError</code> object containing an <code>errors</code> property which holds an array of rejection values.<p>Please see <a href=https://v8.dev/features/promise-combinators#promise.any>our explainer</a> for more.<h3 id=string.prototype.replaceall><code>String.prototype.replaceAll</code> <a href=#string.prototype.replaceall class=bookmark>#</a></h3><p><code>String.prototype.replaceAll</code> provides an easy way to replace all occurrences of a substring without creating a global <code>RegExp</code>.<pre class=language-js><code class=language-js><span class="token keyword">const</span> queryString <span class="token operator">=</span> <span class="token string">'q=query+string+parameters'</span><span class="token punctuation">;</span><br><br><span class="token comment">// Works, but requires escaping inside regular expressions.</span><br>queryString<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token language-regex regex-source">\+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'q=query string parameters'</span><br><br><span class="token comment">// Simpler!</span><br>queryString<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → 'q=query string parameters'</span></code></pre><p>Please see <a href=https://v8.dev/features/string-replaceall>our explainer</a> for more.<h3 id=logical-assignment-operators>Logical assignment operators <a href=#logical-assignment-operators class=bookmark>#</a></h3><p>Logical assignment operators are new compound assignment operators that combine the logical operations <code>&&</code>, <code>||</code>, or <code>??</code> with assignment.<pre class=language-js><code class=language-js>x <span class="token operator">&&=</span> y<span class="token punctuation">;</span><br><span class="token comment">// Roughly equivalent to x && (x = y)</span><br>x <span class="token operator">||=</span> y<span class="token punctuation">;</span><br><span class="token comment">// Roughly equivalent to x || (x = y)</span><br>x <span class="token operator">??=</span> y<span class="token punctuation">;</span><br><span class="token comment">// Roughly equivalent to x ?? (x = y)</span></code></pre><p>Note that, unlike mathematical and bitwise compound assignment operators, logical assignment operators only conditionally perform the assignment.<p>Please read <a href=https://v8.dev/features/logical-assignment>our explainer</a> for a more in-depth explanation.<h2 id=webassembly>WebAssembly <a href=#webassembly class=bookmark>#</a></h2><h3 id=liftoff-shipped-on-all-platforms>Liftoff shipped on all platforms <a href=#liftoff-shipped-on-all-platforms class=bookmark>#</a></h3><p>Since V8 v6.9, <a href=https://v8.dev/blog/liftoff>Liftoff</a> has been used as the baseline compiler for WebAssembly on Intel platforms (and Chrome 69 enabled it on desktop systems). Since we were concerned about memory increase (because of more code being generated by the baseline compiler), we held it back for mobile systems so far. After some experimentation in the last months, we are confident that the memory increase is negligible for most cases, hence we finally enable Liftoff by default on all architectures, bringing increased compilation speed, especially on arm devices (32- and 64-bit). Chrome 85 follows along and ships Liftoff.<h3 id=multi-value-support-shipped>Multi-value support shipped <a href=#multi-value-support-shipped class=bookmark>#</a></h3><p>WebAssembly support for <a href=https://github.com/WebAssembly/multi-value>multi-value code blocks and function returns</a> is now available for general use. This reflects the recent merge of the proposal in the official WebAssembly standard and is supported by all compilation tiers.<p>For instance, this is now a valid WebAssembly function:<pre class=language-wasm><code class=language-wasm><span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$swap</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token keyword">i32</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><br>  <span class="token punctuation">(</span><span class="token keyword">local</span>.get <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">local</span>.get <span class="token number">0</span><span class="token punctuation">)</span><br><span class="token punctuation">)</span></code></pre><p>If the function is exported, it can also be called from JavaScript, and it returns an array:<pre class=language-js><code class=language-js>instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// → [2, 1]</span></code></pre><p>Conversely, if a JavaScript function returns an array (or any iterator), it can be imported and called as a multi-return function inside the WebAssembly module:<pre class=language-js><code class=language-js><span class="token keyword">new</span> <span class="token class-name">WebAssembly<span class="token punctuation">.</span>Instance</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  <span class="token literal-property property">imports</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token function function-variable">swap</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">[</span>y<span class="token punctuation">,</span> x<span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class=language-wasm><code class=language-wasm><span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$main</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i32</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><br>  <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">0</span><br>  <span class="token keyword">i32<span class="token punctuation">.</span>const</span> <span class="token number">1</span><br>  <span class="token keyword">call</span> <span class="token variable">$swap</span><br><span class="token punctuation">)</span></code></pre><p>More importantly, toolchains can now use this feature to generate more compact and faster code within a WebAssembly module.<h3 id=support-for-js-bigints>Support for JS BigInts <a href=#support-for-js-bigints class=bookmark>#</a></h3><p>WebAssembly support for <a href=https://github.com/WebAssembly/JS-BigInt-integration>converting WebAssembly I64 values from and to JavaScript BigInts</a> has been shipped and is available for general use as per the latest change in the official standard.<p>Thereby WebAssembly functions with i64 parameters and return values can be called from JavaScript without precision loss:<pre class=language-wasm><code class=language-wasm><span class="token punctuation">(</span><span class="token keyword">module</span><br>  <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$add</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$x</span> <span class="token keyword">i64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">param</span> <span class="token variable">$y</span> <span class="token keyword">i64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">result</span> <span class="token keyword">i64</span><span class="token punctuation">)</span><br>    <span class="token keyword">local</span>.get <span class="token variable">$x</span><br>    <span class="token keyword">local</span>.get <span class="token variable">$y</span><br>    <span class="token keyword">i64<span class="token punctuation">.</span>add</span><span class="token punctuation">)</span><br>  <span class="token punctuation">(</span><span class="token keyword">export</span> <span class="token string">"add"</span> <span class="token punctuation">(</span><span class="token keyword">func</span> <span class="token variable">$add</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>From JavaScript, only BigInts can be passed as I64 parameter:<pre class=language-js><code class=language-js>WebAssembly<span class="token punctuation">.</span><span class="token function">instantiateStreaming</span><span class="token punctuation">(</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'i64.wasm'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> module<span class="token punctuation">,</span> instance <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">12n</span><span class="token punctuation">,</span> <span class="token number">30n</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// → 42n</span><br>    instance<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// → TypeError: parameters are not of type BigInt</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id=v8-api>V8 API <a href=#v8-api class=bookmark>#</a></h2><p>Please use <code>git log branch-heads/8.4..branch-heads/8.5 include/v8.h</code> to get a list of the API changes.<p>Developers with an active V8 checkout can use <code>git checkout -b 8.5 -t branch-heads/8.5</code> to experiment with the new features in V8 v8.5. Alternatively you can <a href=https://www.google.com/chrome/browser/beta.html>subscribe to Chrome’s Beta channel</a> and try the new features out yourself soon.</div><footer><div><picture><source srcset="/_img/avatars/zeynep-cankara.avif, /_img/avatars/zeynep-cankara@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/zeynep-cankara.jpg srcset="/_img/avatars/zeynep-cankara@2x.jpg 2x" width=96></picture><p>作者：Zeynep Cankara, tracking some Maps.</div></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/v8-release-85>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/v8-release-85.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>