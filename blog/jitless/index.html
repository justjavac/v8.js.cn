<!doctype html><html lang=zh-CN><meta charset=utf-8><title>JIT-less V8 · V8</title><meta content="width=device-width" name=viewport><meta content="dark light" name=color-scheme><link href=/_css/main.css rel=stylesheet><link href=/.webmanifest rel=manifest><meta content=#4285F4 name=theme-color><link href=/blog.atom rel=alternate title="V8 Atom feed" type=application/atom+xml><link href=/features.atom rel=alternate title="V8 JS/Wasm features Atom feed" type=application/atom+xml><script>document.documentElement.className+=" js"</script><meta content="V8 v7.4 supports JavaScript execution without allocating executable memory at runtime." name=description><header id=header><h1><a href=/ >V8</a></h1><a href=#navigation-toggle id=nav-toggle>显示导肮</a><nav><ul><li><a href=/ >主页</a><li class=active><a href=/blog/ >博客</a><li><a href=/docs/ >文档</a><li><a href=/tools/ >工具</a><li><a href=/features title="JavaScript 和 WebAssembly 的新特性">JS/Wasm 新特性</a><li><a href=/grant>Research</a></ul></nav></header><main id=main><article itemscope itemtype=http://schema.org/BlogPosting><header><h1 itemprop=headline>JIT-less V8</h1><p class=meta>发布时间 <time datetime="2019-03-13 13:03:19" itemprop=datePublished title="2019-03-13 13:03:19">2019-03-13</time> · 标签： <a href=/blog/tags/internals/ class=tag>internals</a></header><div itemprop=articleBody><p>V8 v7.4 now supports JavaScript execution without allocating executable memory at runtime.<p>In its default configuration, V8 relies heavily on the ability to allocate and modify executable memory at runtime. For example, the <a href=/blog/turbofan-jit>TurboFan optimizing compiler</a> creates native code for hot JavaScript (JS) functions just-in-time, and most JS regular expressions are compiled down to native code by the <a href=https://blog.chromium.org/2009/02/irregexp-google-chromes-new-regexp.html>irregexp engine</a>. Creating executable memory at runtime is part of what makes V8 fast.<p>But in some situations it can be desirable to run V8 without allocating executable memory:<ol><li>Some platforms (e.g. iOS, smart TVs, game consoles) prohibit write access to executable memory for non-privileged applications, and it has thus been impossible to use V8 there so far; and<li>disallowing writes to executable memory reduces the attack surface of the application for exploits.</ol><p>V8’s new JIT-less mode is intended to address these points. When V8 is started with the <code>--jitless</code> flag, V8 runs without any runtime allocation of executable memory.<p>How does it work? Essentially, V8 switches into an interpreter-only mode based on our existing technology: all JS user code runs through the <a href=/blog/ignition-interpreter>Ignition interpreter</a>, and regular expression pattern matching is likewise interpreted. WebAssembly is currently unsupported, but interpretation is also in the realm of possibility. V8’s builtins are still compiled to native code, but are no longer part of the managed JS heap, thanks to our recent efforts to <a href=/blog/embedded-builtins>embed them into the V8 binary</a>.<p>Ultimately, these changes allowed us to create V8’s heap without requiring executable permissions for any of its memory regions.<h2 id=results>Results <a href=#results class=bookmark>#</a></h2><p>Since JIT-less mode disables the optimizing compiler, it comes with a performance penalty. We looked at a variety of benchmarks to better understand how V8’s performance characteristics change. <a href=/blog/speedometer-2>Speedometer 2.0</a> is intended to represent a typical web application; the <a href=/blog/web-tooling-benchmark>Web Tooling Benchmark</a> includes a set of common JS developer tools; and we also include a benchmark that simulates a <a href="https://chromeperf.appspot.com/report?sid=518c637ffa0961f965afe51d06979375467b12b87e72061598763e5a36876306">browsing workflow on the Living Room YouTube app</a>. All measurements were made locally on an x64 Linux desktop over 5 runs.<figure><img alt="" height=371 loading=lazy src=/_img/jitless/benchmarks.svg width=600><figcaption>JIT-less vs. default V8. Scores are normalized to 100 for V8’s default configuration.</figcaption></figure><p>Speedometer 2.0 is around 40% slower in JIT-less mode. Roughly half of the regression can be attributed to the disabled optimizing compiler. The other half is caused by the regular expression interpreter, which was originally intended as a debugging aid, and will see performance improvements in the future.<p>The Web Tooling Benchmark tends to spend more time in TurboFan-optimized code and thus shows a larger regression of 80% when JIT-less mode is enabled.<p>Finally, we measured a simulated browsing session on the Living Room YouTube app which includes both video playback and menu navigation. Here, JIT-less mode is roughly on-par and only shows a 6% slowdown in JS execution compared to a standard V8 configuration. This benchmark demonstrates how peak optimized code performance is not always correlated to <a href=/blog/real-world-performance>real-world performance</a>, and in many situations embedders can maintain reasonable performance even in JIT-less mode.<p>Memory consumption only changed slightly, with a median of 1.7% decrease of V8’s heap size for loading a representative set of websites.<p>We encourage embedders on restricted platforms or with special security requirements to consider V8’s new JIT-less mode, available now in V8 v7.4. As always, questions and feedback are welcome at the <a href=https://groups.google.com/forum/#!forum/v8-users>v8-users</a> discussion group.<h2 id=faq>FAQ <a href=#faq class=bookmark>#</a></h2><p><em>What’s the difference between <code>--jitless</code> and <code>--no-opt</code>?</em><p><code>--no-opt</code> disables the TurboFan optimizing compiler. <code>--jitless</code> disables all runtime allocation of executable memory.</div><footer><div><picture><source srcset="/_img/avatars/jakob-gruber.avif, /_img/avatars/jakob-gruber@2x.avif 2x" type=image/avif><img alt="" height=96 loading=lazy src=/_img/avatars/jakob-gruber.jpg width=96 srcset="/_img/avatars/jakob-gruber@2x.jpg 2x"></picture><p>作者：Jakob Gruber (<a href=https://twitter.com/schuay>@schuay</a>).</div><a href=https://twitter.com/v8js/status/1105777150051999744 class=retweet>Retweet this article!</a></footer></article></main><footer id=footer><div><nav><a href=https://v8.dev/blog/jitless>原文</a> · <a href=/logo/ >商标</a> · <a href=/terms/ >条款</a> · <a href=https://policies.google.com/privacy/ >隐私</a> · <a href=https://twitter.com/v8js rel="me nofollow">Twitter</a> · <a href=https://github.com/justjavac/v8.js.cn/tree/master/./src/blog/jitless.md rel=nofollow>在 GitHub 编辑此页面</a></nav><dark-mode-toggle dark="Light Theme" light="Dark Theme" permanent></dark-mode-toggle></div><p><small>如无特殊说明，此 V8 项目中使用到的所有示例代码均基于 <a href=https://chromium.googlesource.com/v8/v8.git/+/master/LICENSE>V8's BSD-style license</a> 发布。页面中的文字内容采用 <a href=https://creativecommons.org/licenses/by/3.0/ >the Creative Commons Attribution 3.0 License</a> 进行许可。更详细的信息可以在 <a href=/terms#site-policies>站点策略</a> 中找到。</small></footer><script src=/_js/dark-mode-toggle.mjs type=module></script><script src=/_js/main.mjs type=module></script><script src=/_js/legacy.js nomodule></script>